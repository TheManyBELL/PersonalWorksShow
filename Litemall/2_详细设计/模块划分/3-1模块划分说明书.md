

<img src="/Users/qinwen/Library/Mobile Documents/com~apple~CloudDocs/大三上/OOAD/三大课需求分析作业合集/校徽/校徽.png" alt="校徽" style="zoom:60%;" />

<h1><center>Litemall系统</br>
  模块划分设计说明书</br>
  </center></h1>

















<center>厦门大学软件学院2017级 3-1小组<br/>
组长：郑钦文<br/>
组员：颜倩 刘佳硕 蔡郭平 叶颖津<br/>
</center>

















[toc]



















## 1. 组件图

<img src="/Users/qinwen/Desktop/ComponentDiagram.jpg" alt="ComponentDiagram" style="zoom:80%;" />

## 2. API文档

#### 总接口文档

106.14.83.157:8080/docs

#### 模块接口API文档

106.14.83.157:8081/docs

## 3. 模块划分说明

**共14个模块**

### 3.1. 模块划分依据

商品总数：目前按`10万`件计算（不包括具体规格）

用户数量：目前按`1万`人计算

预计负载：见下表

| 负载级别 | 描述                                 |
| -------- | ------------------------------------ |
| 非常低   | 管理员专用功能；系统定期自动更新功能 |
| 低       | 商城不常用功能；                     |
| 高       | 商城常用功能                         |
| 非常高   | 会造成瞬间大量负载的功能             |

#### Ad-and-Topic：广告与专题模块

| 数据库表名 | 预测记录数量级 | 模块主要调用场景                 | 预计负载 |
| ---------- | -------------- | -------------------------------- | -------- |
| ad         | 100            | 登陆商城首页调用；管理员增删改查 | 低       |
| topic      | 100            | 登陆商城首页调用；管理员增删改查 | 低       |

广告和专题模块表数据量均很小，实现难度较低，故放在一个模块。

#### Admin：管理员与日志模块

| 数据库表名 | 预测记录数量级         | 模块主要调用场景 | 预计负载 |
| ---------- | ---------------------- | ---------------- | -------- |
| admin      | 100                    | 记录管理员信息   | 非常低   |
| log        | 随着系统的运行逐渐增多 | 管理员查看       | 非常低   |

admin存储管理员信息，提供管理员专用功能，处于安全等考虑需要为其划分出模块。

log是专属管理员的表，所以和admin放一起；

当管理员在管理员前端操作时，被操作的模块都会调用log来生成日志，因此log和所有模块都有内部接口，考虑到在图中全部画出会使得组件图不清晰，将以注解的形式说明，不画接口连线。

#### Share：分享模块

| 数据库表名 | 预测记录数量级  | 模块主要调用场景                     | 预计负载 |
| ---------- | --------------- | ------------------------------------ | -------- |
| share_rule | 10万            | 系统定期更新返点                     | 非常低   |
| share_item | 1万*100 = 100万 | 用户分享商品时增加；系统定期更新返点 | 低       |

分享规则和分享记录之间联系紧密，系统定期更新返点时需要多次查询分享规则，故放一起，但是beshared_item表并不在此模块，解释见下。

#### BeShared：被分享模块

| 数据库表名    | 预测记录数量级 | 模块主要调用场景 | 预计负载 |
| ------------- | -------------- | ---------------- | -------- |
| beshared_item | 1000万-1亿     | 用户增；系统查   | 低       |

数据量巨大，且被分享记录产生后主要由时钟控制，定期删除，故单独作为一个模块。

且和分享模块只会在计算返点时和分享模块发生联系，而计算返点目前为系统定期执行的低负载操作，因此和分享模块中两表的关系并不密切。

#### Groupon：团购模块

| 数据库表名   | 预测记录数量级 | 模块主要调用场景                       | 预计负载                               |
| ------------ | -------------- | -------------------------------------- | -------------------------------------- |
| groupon_rule | 1000           | 处理团购订单时调用；**用户下团购订单** | 低（平常）；非常高（大力度团购活动时） |

在大力度团购时会频繁查询该表，确认团购是否到达上限，因此虽然表本身记录数量少，但会在特定时期高并发，故单独作为一个模块。

另一种方法是和下面的优惠券类放在一个模块中，因为设计上可能有通用代码，但是两个高并发模块合并会大幅度提高实现难度，可能会没有小组愿意承接。本文档综合考虑设计与实现，选择将团购和优惠券分模块实现。

#### Coupon：优惠券模块

| 数据库表名  | 预测记录数量级 | 模块主要调用场景                         | 预计负载                               |
| ----------- | -------------- | ---------------------------------------- | -------------------------------------- |
| coupon      | 10万-1000万    | 用户增；系统查                           | 低（平常）；非常高（高并发抢优惠券时） |
| coupon_rule | 1000-10万      | 管理员设置；根据优惠券查询规则；主页显示 | 低                                     |

在限时限量优惠券领取时会频繁查询该表，确认已领取优惠券是否到达上限，即会在特定时期高并发；

又因为记录数据量巨大，高峰期相互查询次数非常多，故合并作为一个模块。

#### Goods：商品模块

| 数据库表名     | 预测记录数量级 | 模块主要调用场景                         | 预计负载 |
| -------------- | -------------- | ---------------------------------------- | -------- |
| goods          | 10万           | 查看商品各种信息                         | 高       |
| product        | 10万-100万     | 订单模块获取产品信息；用户获取购物车信息 | 高       |
| brand          | 100            | 查看品牌；获取品牌下所有商品             | 低       |
| goods_category | 100            | 查看分类；获取分类下所有商品             | 高       |

goods与product联系紧密，经常需求相互查询，故放在一起；

brand和goods_category数量均较小，且逻辑基本相同（返回商品列表），故和商品放在一起

#### Comment：评论模块

| 数据库表名 | 预测记录数量级 | 模块主要调用场景                           | 预计负载 |
| ---------- | -------------- | ------------------------------------------ | -------- |
| comment    | 1000万-10亿    | 查看商品评论；用户新增评论；管理员审核评论 | 高       |

数据量巨大，查看和发表评论是日常负载高的操作，故单独作为一个模块。

#### AftersaleService：售后模块

| 数据库表名    | 预测记录数量级 | 模块主要调用场景 | 预计负载 |
| ------------- | -------------- | ---------------- | -------- |
| after_service | 10万-100万     | 用户申请售后     | 低       |

数据量较大，且逻辑相对独立，故单独作为一个模块

#### Order：订单模块

| 数据库表名 | 预测记录数量级 | 模块主要调用场景                   | 预计负载 |
| ---------- | -------------- | ---------------------------------- | -------- |
| order      | 10万-100万     | 订单相关事务                       | 高       |
| order_item | 100万-1000万   | 退换货、订单查看产品               | 高       |
| payment    | 100万-1000万   | 查询支付结果；下订单后生成支付结果 | 高       |

order_item和依附于order存在，且经常互相查询，故合并一个模块。

payment为支付结果记录表，payment

#### Cart：购物车模块

| 数据库表名 | 预测记录数量级 | 模块主要调用场景 | 预计负载 |
| ---------- | -------------- | ---------------- | -------- |
| cart_item  | 100万          | 用户增删改查     | 高       |

数据量很大，负载较高，故单独作为一个模块。

#### Collect：收藏夹模块

| 数据库表名   | 预测记录数量级 | 模块主要调用场景 | 预计负载 |
| ------------ | -------------- | ---------------- | -------- |
| collect_item | 100万          | 用户增删改查     | 高       |

和购物车模块类似：数据量较大，负载较高，故单独作为一个模块

#### Footprint：足迹模块

| 数据库表名     | 预测记录数量级 | 模块主要调用场景       | 预计负载 |
| -------------- | -------------- | ---------------------- | -------- |
| footprint_item | 1000万         | 用户增；用户根据足迹查 | 高       |

和购物车模块类似：数据量较大，负载较高，故单独作为一个模块

#### User：用户模块

| 数据库表名 | 预测记录数量级 | 模块主要调用场景 | 预计负载 |
| ---------- | -------------- | ---------------- | -------- |
| user       | 1万            | 查询用户信息     | 低       |
| address    | 10万-100万     | 用户增删改；查询 | 低       |

记录用户的基本信息，提供增删改查功能，但这部分因为操作不频繁，负载较小。

地址模块和其他模块都没有模块间调用行为，其他模块需要用户地址时，直接由前端API向地址模块发送URI请求，在前端获取地址列表，然后由前端返回给需要地址的模块。但是考虑到user在逻辑上拥有address，且user的负载较低，因此选择将两个功能合并为一个模块。

### 3.2. 模块间接口设计说明

**共9个模块间接口**

> /goods/{goodsId}  为模块通用接口
>
> /log  为模块通用接口

| 模块调用（表之间）          | 动词 | URI                          |
| --------------------------- | ---- | ---------------------------- |
| groupon_rule -> goods       | GET  | /goods/{goodsId}             |
| footprint_item -> goods     | GET  | /goods/{goodsId}             |
| collect_item -> goods       | GET  | /goods/{goodsId}             |
| cart_item -> product        | GET  | /product/{productId}         |
| order -> be_share_item      | PUT  | /share/besharedLog           |
| be_share_item -> share_item | PUT  | /share/shareLog/{shareLogId} |
| share_item -> user(rebate)  | PUT  | /backpoint                   |
| order -> coupon             | PUT  | /coupon/{couponId}/use       |
| order -> user(rebate)       | PUT  | /backpoint                   |
| aftersale_service -> order  | PUT  | /order/{orderId}             |
| -> log                      | POST | /log                         |

#### /goods/{goodsId}

`团购模块调用商品模块 ` `GET`  

在查看具体的某条团购信息时，前端仅持有团购id，故需要请求具体的团购信息。

而在团购服务保存的团购信息尚不完整，故需要去向goods服务请求goods信息。

#### /goods/{goodsId}

 `足迹模块调用商品模块` `GET`

在查看具体的足迹信息时，前端需要请求足迹列表。

而在足迹服务保存的足迹信息尚不完整，故需要去向goods服务请求goods信息。

#### /goods/{goodsId}

`收藏夹模块调用商品模块  ` `GET` 

在查看具体的收藏信息时，前端需要请求收藏列表。

而在收藏服务保存的收藏信息尚不完整，故需要去向goods服务请求goods信息。

#### /product/{productId}

`购物车模块调商品模块` `GET`

在查看具体的购物车信息时，前端需要请求购物车列表。

而在购物车服务保存的购物车信息尚不完整，故需要去向goods服务请求goods信息。

#### /share/besharedLog

`订单模块调用被分享模块 `  `PUT` 

在完成一条订单时，如果它与某个被分享记录有关，则需要修改该被分享记录，使之无效化

#### /share/shareLog/{shareLogId}

`被分享模块调用分享模块` `PUT`

在一条被分享记录因为订单成功而被无效化时，应该修改与之有关的分享记录，使得计数增加

#### /backpoint

`分享模块调用用户模块` `PUT`

在一条分享记录计数增加时，应该修改用户的返点数量，使之增加

#### /coupon/{couponId}/use

`订单模块调用优惠券模块` `GET`   

订单模块从前端接受订单信息，需要对其中使用的优惠券进行合法性校验，这一校验意味着订单模块需要拿着couponID和userID去优惠券模块查询中用户目前是否拥有该优惠券。这一过程不涉及前端操作，全部在后端完成 

#### /backpoint

`订单模块调用用户模块` `GET`

订单模块从前端接受订单信息，需要对其中使用的返点数量进行校验，这一校验意味着订单模块需要拿着userID和返点数量去查询用户模块中用户目前实际拥有的返点总数，这一过程不涉及前端操作，全部在后端完成 

`订单模块调用用户模块` `PUT`

订单在支付完成够会扣除所使用的返点。

#### /order/{orderId}

`售后模块调用订单模块` `PUT`

售后模块中，售后工作处理好后需要修改订单状态，这一过程是模块间自动完成的，不涉及前端操作。 

#### /log

`任何模块调用日志模块` `POST`

当管理员对某个模块进行操作后，该模块会调用日志模块来生成管理员操作记录。